provisioner: azure
name: git-clone
version: 1
revision: 1
displayName: Git clone
description: Clone remote Git repository and checkout a given commit if specified.
target: ""
category: git
keywords:
  - git
  - clone
  - checkout
author: CloudCover
meta: {}
inputs:
  properties:
    git_checkout_target:
      title: Checkout Target
      description: Git branch, tag or commit hash to checkout.
      type: string
      default: ""
    git_local_path:
      title: Local Clone Directory
      description: The name of a new directory to clone into.
      type: string
      default: repo
    git_remote_path:
      title: Repository URL
      description: The repository to clone from.
      type: string
  internal:
    - git_remote_path
    - git_local_path
    - git_checkout_target
template: |
  steps:
  - script: |
      git clone {% if git_checkout_target %}--no-checkout{% endif %} {{ git_remote_path }} {{ git_local_path }}{% if git_checkout_target %}
      cd {{ git_local_path }} && git checkout {{ git_checkout_target }} && cd .. {% endif %}
      cd {{ git_local_path }}
      sha_tag=$(git log --format="%H" -n 1);
      echo "##vso[task.setvariable variable=sha_tag]$sha_tag"
    displayName: 'Git Clone'
