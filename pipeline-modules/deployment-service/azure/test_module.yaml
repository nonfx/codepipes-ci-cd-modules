provisioner: azure
name: test_module
version: 1
revision: 1
displayName: Test Module
description: Module for the integration test
target: "test"
keywords:
  - test
author: CloudCover
meta:
  inputArtifactType:
    - ContainerImage

inputs:
  properties:
    echo_float:
      title: Echo Float value
      description: The float to echo to the log.
      type: number
    echo_int:
      title: Echo Integer value
      description: The integer to echo to the log.
      type: integer
    echo_list:
      title: Echo List value
      description: The List to echo to the log.
      type: array
      items:
        type: string
    echo_map:
      title: Echo Map value
      description: The Map to echo to the log.
      type: object
      default: {"key":"val"}
    echo_string:
      title: Echo String value
      description: The string to echo to the log.
      type: string
    pool_name:
      title: Pool Name
      description: Use  Azure selfhosted agent by proving agent pool name.
      type: string
      default: ""      

  required:
    - echo_string
    - echo_int
    - echo_float
    - echo_list
template: |
  steps:
  - script: |
      echo "stringVal={{ echo_string }}"
      echo "intVal={{ echo_int }}"
      echo "floatVal={{ echo_float }}"
      echo "mapVal:"
      {% for map_key, map_value in echo_map %}
      echo "    {{ map_key }}={{ map_value }}"
      {% endfor %}
      echo "listVal:"
      {% for list_value in echo_list %}
      echo "    {{ list_value }}"
      {% endfor %}
  - script: |
      echo "###pipeline-summary-start###" >> summary.txt 2>&1
      {% if pipeline_summary_var %}
      {% for summary in pipeline_summary_var %}
      {{ summary.Command }} | xargs -0 printf "{{ summary.Name }}=%s\n" >>  summary.txt 2>&1 {% endfor %}
      {% endif %}
      echo "Service URL=[test_module succeeded: $(date)]" >> summary.txt 2>&1
      echo "###pipeline-summary-end###" >> summary.txt 2>&1
      cat summary.txt