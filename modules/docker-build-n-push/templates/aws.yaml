version: 0.2

phases:
  build:
    commands:
      - echo Logging in to docker
      - echo $docker_password | docker login -u $docker_username --password-stdin $docker_registry
      - echo Build started on `date`
      - echo Building the Docker image...
      - docker build -t {{container_repository}}:{{container_tag}} {% for arg in docker_build_args %} {{ arg }} {% endfor %} .
      - echo Build completed on `date`
      - echo Pushing the Docker image...
      - docker push {{container_repository}}:{{container_tag}}
      {% if use_github_tag %}
      - echo Building the Docker image with Commit hash...
      - docker build -t {{container_repository}}:{{sha_tag}} {% for arg in docker_build_args %} {{ arg }} {% endfor %} .
      - echo Build completed on `date`
      - echo Pushing the Docker image with Commit hash...
      - docker push {{container_repository}}:{{sha_tag}}
      {% endif %}
      
