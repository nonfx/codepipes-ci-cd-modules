steps:
- id: 'Docker login'
  name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args:
  - '-c'
  - |
    echo $$docker_password | docker login -u $$docker_username --password-stdin $$docker_registry
- id: 'Docker Build and Push'
  name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  dir: {{ working_dir }}
  args:
  - '-c'
  - |
    {% if use_github_tag == true %}
    docker build -t {{container_repository}}:{{sha_tag}} .
    docker push {{container_repository}}:{{sha_tag}}
    {% endif %}
    docker build -t {{container_repository}}:{{container_tag}} {% for arg in docker_build_args %} {{ arg }} {% endfor %} .
    docker push {{container_repository}}:{{container_tag}}
